------------------------------------- Exploring Data

--GDPCAP table contains GDP per Capita 2020
SELECT * FROM GDPCAP 

--GDP2020 table contains GDP 2020 

SELECT * FROM GDP2020

--Billion table contains the list of Billionaires as of 2021

SELECT * FROM Billion


--------------------------------------------GDP Per Capita and Total GDP Comparison

SELECT 

GDPCAPRANK = ROW_NUMBER() OVER(ORDER BY CAP DESC),
country,
CAP 

FROM GDPCAP 
WHERE  CAP IS NOT NULL



SELECT 

GDPRANK = ROW_NUMBER() OVER(ORDER BY GDP DESC),
country,
GDP

FROM GDP2020




------------------------------------------------- GDP Total Rank with CTE

WITH GDP_Rank AS 
(
SELECT 
GDPRANK = ROW_NUMBER() OVER(ORDER BY GDP DESC),
country,
GDP 

FROM GDP2020 ),

GDP_CAP_Rank AS 
(
SELECT 

GDPCAPRANK = ROW_NUMBER() OVER(ORDER BY CAP DESC),
country,
CAP

FROM GDPCAP )

SELECT

A.country,
GDPCAPRANK,
CAP, 
GDPRANK,
GDP,
GDP_GDPCAP_RATIO = (GDPRANK*0.1)/(GDPCAPRANK *0.1)

FROM GDP_CAP_Rank A
INNER JOIN GDP_Rank B
ON A.country = B.country 



ORDER BY GDP_GDPCAP_RATIO ASC 
WHERE GDPRANK < 10 
ORDER BY GDP_GDPCAP_RATIO ASC 




Top 10 GDP Countries and per capita rank comaprison 


----------------------------------------------------------------------------
country	GDPCAPRANK	CAP	GDPRANK	GDP	GDP_GDPCAP_RATIO
China	80	10434.7751874839	2	14722730.6978901	0.02500000000000000
India	182	1927.70782309335	6	2622983.73200645	0.03296703296703296
Japan	28	40193.2524448357	3	5064872.87560459	0.10714285714285714
United States	8	63206.5210767941	1	20936600	0.12500000000000000
United Kingdom	27	41059.1688090547	5	2707743.77717391	0.18518518518518518
Germany	20	46252.6893044892	4	3806060.14012452	0.20000000000000000
Italy	36	31769.9658684833	8	1886445.26834071	0.22222222222222222
France	30	39037.1226309074	7	2603004.39590195	0.23333333333333333
Canada	25	43258.2638715602	9	1643407.97706893	0.36000000000000000




-------------------------------------Data Cleaning on mismatching country Name 

--UPDATE Billion
--SET country = 'Korea, Rep.' WHERE country LIKE '%Korea%'
--UPDATE Billion
--SET country = 'Russian Federation' WHERE country LIKE '%Russia%'
--UPDATE Billion
--SET country = 'Egypt, Arab Rep.' WHERE country LIKE '%Egypt%'
--UPDATE Billion
--SET country = 'Hong Kong SAR, China' WHERE country LIKE '%Hong Kong%'
--UPDATE Billion
--SET country = 'Czech Republic' WHERE country LIKE '%Czech%'
--UPDATE Billion
--SET country = 'Slovak Republic' WHERE country LIKE '%Slovak%'
--UPDATE Billion
--SET country = 'Venezuela, RB' WHERE country LIKE '%Venezuela%'
--UPDATE Billion
--SET country = 'Eswatini' WHERE country LIKE '%Eswatini%'
--UPDATE Billion
--SET country = 'United Kingdom' WHERE country LIKE '%guernsey%'
--UPDATE Billion
--SET country = 'Macao SAR, China' WHERE country LIKE '%Macau%'
--UPDATE Billion
--SET country = 'China' WHERE country LIKE '%Taiwan%'

----------------------------------------------------------- GDP & GDP PER CAPITA RATIO TO COMPARE WEALTH OF A COUNTRY VS WEALTH OF POPULATION





WITH GDP_Rank AS 
(
SELECT 
GDPRANK = ROW_NUMBER() OVER(ORDER BY GDP DESC),
country,
GDP 

FROM GDP2020 ),

GDP_CAP_Rank AS 
(
SELECT 

GDPCAPRANK = ROW_NUMBER() OVER(ORDER BY CAP DESC),
country,
CAP

FROM GDPCAP )

SELECT

A.country,
Rank,
name,
networth,
GDPCAPRANK,
CAP, 
GDPRANK,
GDP,
GDP_GDPCAP_RATIO = (GDPRANK*0.1)/(GDPCAPRANK *0.1)

FROM Billion A
INNER JOIN GDP_Rank B
ON A.country = B.country 
INNER JOIN GDP_CAP_Rank C
ON A.country = C.country 

ORDER BY GDPRANK DESC



---------------------------------------------------------------Merging with Billionaire list Data type Varchar to INT
 -- Currently, networth is set to be $ US in Billions, need to convert this in $ US Million, and to INT
 

 -- First strip the 'B' & '$' Characters and assign it in a temporary column

 ALTER TABLE Billion
 ADD networth_M VARCHAR(40) 

 UPDATE Billion
 SET networth_M = (REPLACE(REPLACE(networth, '$',''),'B',''))


 -- Add another column to cast vharchar as int & convert to numeric 


ALTER TABLE Billion
ADD networth_num DECIMAL(10,4)


UPDATE Billion
SET networth_num = CAST (networth_M AS DECIMAL(10,4))*1000
  


SELECT * FROM Billion




  -------------------------------------------------------------- USE CTE TO merge Billionaire list & GDP 
  WITH GDPTABLE AS  (
  SELECT 
  country,
  GDP,
  GDPRANK = RANK() OVER(ORDER BY GDP DESC )  
  FROM GDP2020

  ) 
  SELECT 
 
  B.country,
  COUNT(DISTINCT(name)) AS Billionaire_counts ,
  SUM(networth_num) AS networth,
  SUM(GDP) AS Country_total_GDP, 
  percent_gdp = (SUM(networth_num) / SUM(GDP))
  FROM BILLION B
  
  INNER JOIN GDPTABLE  
  ON B.country = GDPTABLE.country 
  

  GROUP BY B.Country 
  HAVING SUM(GDP) > 0 
  ORDER BY percent_gdp DESC



--There
--------------------------------------------------------------------
percent_gdp
country	Billionaire_counts	networth	Country_total_GDP	percent_gdp
Belize	1	3600.0000	1763.6961189519	2.04116795479447
St. Kitts and Nevis	1	1500.0000	927.451851851852	1.6173346325256
Eswatini	1	5300.0000	3962.49309299308	1.33754176363665
Monaco	4	15100.0000	29694.8393596776	0.508505865854394
Barbados	1	1700.0000	4365.5	0.389417019814454
Liechtenstein	1	2300.0000	6839.14510686164	0.336299342105263
Cyprus	3	17200.0000	71413.0211307825	0.240852434579132
Georgia	2	6700.0000	31783.3778063686	0.210802012322853
Zimbabwe	1	3000.0000	16768.5134426415	0.178906735547061
Iceland	2	3600.0000	43429.3411392066	0.0828932676749737
Lebanon	6	12600.0000	200299.48114548	0.0629058044880729
Nepal	1	1500.0000	33657.175561329	0.0445670195131718
Estonia	1	1200.0000	31029.9685912779	0.0386722918030057
Algeria	1	5100.0000	145163.902228168	0.0351327011861657
Macao SAR, China	1	1900.0000	55153.7079487021	0.0344491797680615
Oman	1	2500.0000	76331.5186685771	0.0327518703100186
Bulgaria	2	4000.0000	138210.202179106	0.0289414235485772
Uruguay	2	3000.0000	107257.654880716	0.0279700316339786
Tanzania	1	1500.0000	62409.7484265824	0.024034706721572
Czech Republic	9	49000.0000	2191773.41907132	0.0223563255095784
Colombia	4	24100.0000	1085387.58650567	0.0222040497787415
Chile	7	38600.0000	1770580.16132208	0.0218007638644148
Nigeria	3	28200.0000	1296881.32878719	0.0217444721996051
New Zealand	3	13200.0000	637446.040815141	0.0207076350856621
Kazakhstan	5	17400.0000	849177.132135765	0.0204904246022703
Portugal	1	4700.0000	231255.587276741	0.0203238332761905
Greece	4	15200.0000	757640.426480064	0.0200622874238878
Denmark	8	56000.0000	2841472.19873003	0.0197080935808658
South Africa	5	25000.0000	1509618.19634776	0.0165604787094398
Hong Kong SAR, China	67	383400.0000	23221254.0607435	0.0165107361987031
Morocco	2	3300.0000	225741.183388088	0.0146185111217687
Ireland	9	54800.0000	3767596.36634074	0.014545082506602
Slovak Republic	2	3000.0000	209148.292496728	0.0143438895158417
Austria	11	61700.0000	4718619.37755402	0.0130758586491423
Peru	3	7800.0000	606043.091361699	0.0128703719441375
Singapore	25	105700.0000	8499961.94824963	0.0124353497866854
Ukraine	6	10900.0000	933492.052304556	0.0116765857546303
Qatar	2	3300.0000	292747.177733022	0.0112725254110204
Vietnam	7	21200.0000	1898109.09441357	0.0111690102862869
Malaysia	17	63100.0000	5723295.55219971	0.0110251164603491
Mexico	15	160900.0000	16142449.7426241	0.00996750818899216
Israel	29	111600.0000	11656660.3402755	0.00957392569931931
Norway	13	40900.0000	4706116.43508275	0.00869081769739104
Egypt, Arab Rep.	6	18300.0000	2178415.47099189	0.00840060137457045
Hungary	2	2500.0000	310025.855258174	0.00806384357175025
Belgium	3	11900.0000	1545997.49888358	0.00769729576444554
Romania	5	9200.0000	1243577.75683318	0.00739800945252366
Sweden	45	165700.0000	24192443.9573559	0.00684924599978738
Philippines	18	44200.0000	6506808.3783	0.00679288484157696
Thailand	28	95300.0000	14050258.9339068	0.00678279314625419
Finland	7	12600.0000	1898637.18382724	0.00663633900532861
United Arab Emirates	3	7800.0000	1263426.80381212	0.00617368570657611
Argentina	6	14000.0000	2298401.86592136	0.00609118892895948
Switzerland	41	181900.0000	30666714.0831343	0.00593151256788998
Poland	7	20800.0000	4159152.83626455	0.00500101843304249
France	43	550000.0000	111929189.023784	0.00491382100412727
Netherlands	11	38000.0000	10034665.6863098	0.00378687254642107
Indonesia	30	115100.0000	31752715.1503542	0.00362488686258744
Australia	44	205100.0000	58559640.7025071	0.00350241219958884
Spain	26	115000.0000	33311176.3664251	0.00345229477143024
Canada	64	307900.0000	105178110.532412	0.00292741520494531
Russian Federation	81	318200.0000	120163320.574276	0.00264806264073997
Turkey	24	40800.0000	17282429.0974587	0.00236077924983354
Brazil	60	184700.0000	86683995.5382989	0.00213072781028414
Italy	52	194500.0000	98095153.9537168	0.00198276869101779
India	161	744800.0000	422300380.853038	0.00176367352190287
Korea, Rep.	41	109300.0000	66851525.2242336	0.00163496643694195
United Kingdom	50	201600.0000	135387188.858695	0.00148906260407262
Germany	130	604000.0000	494787818.216187	0.00122072528417847
Japan	36	150500.0000	182335423.521765	0.000825401872511267
United States	719	4685100.0000	15053415400	0.000311231695632341
China	564	2089350.0000	8333065575.00587	0.00025073005620726